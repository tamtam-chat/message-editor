(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();function He(e){return e.ownerDocument.createTreeWalker(e,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT)}function ce(e){return e.nodeType===Node.TEXT_NODE}function $(e){return e.nodeType===Node.ELEMENT_NODE}function V(e){return ce(e)?e.nodeValue:$(e)?e.nodeName==="BR"&&(e.previousSibling||e.nextSibling)?`
`:e.getAttribute("data-raw")||"":""}function Ot(e){let t="",n;for(let i=0;i<e.childNodes.length;i++){const r=e.childNodes[i];i>0&&(t+=V(r)||`
`);const o=He(r);for(;n=o.nextNode();)t+=V(n)}return t}const F=String.prototype.startsWith?(e,t)=>e.startsWith(t):(e,t)=>e.slice(0,t.length)===t;function Le(e){return e[0]===e[1]}var c=(e=>(e.Text="text",e.Link="link",e.UserSticker="user_sticker",e.Mention="mention",e.Command="command",e.HashTag="hashtag",e.Markdown="markdown",e.Newline="newline",e))(c||{}),l=(e=>(e[e.None=0]="None",e[e.Bold=1]="Bold",e[e.Italic=2]="Italic",e[e.Underline=4]="Underline",e[e.Strike=8]="Strike",e[e.Monospace=16]="Monospace",e[e.Heading=32]="Heading",e[e.Marked=64]="Marked",e[e.Highlight=128]="Highlight",e[e.LinkLabel=256]="LinkLabel",e[e.Link=512]="Link",e))(l||{});const y=(...e)=>Object.assign({},...e),f={Asterisk:42,Underscore:95,BackTick:96,Tilde:126,Exclamation:33,DoubleQuote:34,SingleQuote:39,Comma:44,Dot:46,Colon:58,SemiColon:59,Question:63,RoundBracketOpen:40,RoundBracketClose:41,SquareBracketOpen:91,SquareBracketClose:93,CurlyBracketOpen:123,CurlyBracketClose:125,LeftAngle:60,RightAngle:62,Hyphen:45,EnDash:8211,EmDash:8212,Tab:9,Space:32,NBSP:160,NewLine:10,Return:13,LineFeed:12,Equal:61,Slash:47,BackSlash:92,Pipe:124,Caret:94,Percent:37,Ampersand:38,Plus:43,At:64,Hash:35},Pt=new Set([f.DoubleQuote,f.SingleQuote,f.SemiColon,f.RoundBracketOpen,f.RoundBracketClose,f.SquareBracketOpen,f.SquareBracketClose,f.CurlyBracketOpen,f.CurlyBracketClose]),Pn=new Set([f.Exclamation,f.Comma,f.Dot,f.Colon,f.Question,f.Hyphen,f.EnDash,f.EmDash]),Dn=new Set([f.Tab,32,160,5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8203,8232,8233,8239,8287,12288,65279]),Dt={markdown:!1,textEmoji:!1,hashtag:!1,mention:!1,command:!1,userSticker:!1,link:!1,stickyLink:!1};function Fn(e){return Pt.has(e)||Pn.has(e)}function _n(e){return Pt.has(e)}function fe(e){return Dn.has(e)}function Ft(e){return e===f.NewLine||e===f.Return||e===f.LineFeed}function z(e){return e===void 0||e!==e||Ft(e)||fe(e)}function G(e){return z(e)||_n(e)}function In(e){return e===f.Underscore||e===f.Hyphen||_t(e)}function $n(e){return e.consume(J)?(e.consumeWhile(In),!0):!1}function se(e,t,n){const{pos:i}=e;let r;for(let o=0;o<t.length;o++)if(r=n?he(e.next()):e.next(),t[o]!==r)return e.pos=i,!1;return!0}function k(e){if(e.length>0)return e[e.length-1]}function O(e,t){const n=[];for(let i=0;i<e.length;i++)n.push(t?he(e.charCodeAt(i)):e.charCodeAt(i));return n}function C(e){return e>47&&e<58}function J(e){return e&=-33,e>=65&&e<=90}function _t(e){return C(e)||J(e)}function It(e){return e===f.SingleQuote||e===f.DoubleQuote}function zn(e){return J(e)||e===1105||e===1025||e>=1040&&e<=1103||e>=1568&&e<=1599||e>=1601&&e<=1610||e===1662||e===1670||e===1688||e===1703||e===1705||e===1711||e>=1729&&e<=1731||e===1740||e>=1641&&e<=1776}function We(e){return J(e)||e>=880&&e<=1023||e>=1024&&e<=1279||e>=1280&&e<=1327||e>=1328&&e<=1423||e>=1424&&e<=1535||e>=1536&&e<=1791||e>=19968&&e<=40959||e>=1792&&e<=1871||e>=1920&&e<=1983||e>=2304&&e<=2431||e>=2432&&e<=2559||e>=2560&&e<=2687||e>=2688&&e<=2815||e>=2816&&e<=2943||e>=2944&&e<=3071||e>=3072&&e<=3199||e>=3200&&e<=3327||e>=3328&&e<=3455||e>=3456&&e<=3583||e>=3584&&e<=3711||e>=3712&&e<=3839||e>=3840&&e<=4095||e>=4096&&e<=4255||e>=4256&&e<=4351||e>=4352&&e<=4607||e>=4608&&e<=4991||e>=5024&&e<=5119||e>=5120&&e<=5759||e>=5760&&e<=5791||e>=5792&&e<=5887||e>=5888&&e<=5919||e>=5920&&e<=5951||e>=5952&&e<=5983||e>=5984&&e<=6015||e>=6016&&e<=6143||e>=6144&&e<=6319||e>=6400&&e<=6479||e>=6480&&e<=6527}function $t(e){return e===f.Underscore||C(e)||zn(e)}function he(e){return e>=97&&e<=122?e&-33:e}function E(e){return Qn(Wn(e))}function me(e){return e.map(t=>t.value).join("")}function A(e){return e.reduce((t,n)=>t+n.value.length,0)}const Un=String.prototype.codePointAt?qn:Hn;function qn(e,t){return e.codePointAt(t)}function Hn(e,t){const n=e.length;if(t<0||t>=n)return;const i=e.charCodeAt(t);if(i>=55296&&i<=56319&&n>t+1){const r=e.charCodeAt(t+1);if(r>=56320&&r<=57343)return(i-55296)*1024+r-56320+65536}return i}function Wn(e){return e.filter(t=>t.value||t.type===c.Text&&t.sticky)}function Qn(e){return e.reduce((t,n)=>{let i=t[t.length-1];if(i&&Vn(i,n)){if(i=y(i),n.emoji){const r=Kn(n.emoji,i.value.length);i.emoji=i.emoji?i.emoji.concat(r):r}i.value+=n.value,t[t.length-1]=i}else t.push(n);return t},[])}function Vn(e,t){if(e.type===t.type&&e.format===t.format)return e.type===c.Link&&e.link===t.link&&ht(e)&&ht(t)||e.type===c.Text}function Kn(e,t){return e.map(n=>y(n,{from:n.from+t,to:n.to+t}))}function ht(e){return e.type===c.Link&&!e.auto}class zt{constructor(t,n,i=0){this.format=0,this.tokens=[],this.formatStack=[],this.textStart=-1,this.textEnd=-1,this.emoji=[],this.brackets={round:0,square:0,curly:0},this.quote=0,this.string=t,this.options=n,this.pos=i}peek(){return Un(this.string,this.pos)}next(){return this.hasNext()?this.inc(this.peek()):NaN}peekPrev(){return this.string.charCodeAt(this.pos-1)}hasNext(){return this.pos<this.string.length}hasPendingText(){return this.textStart!==this.textEnd}consume(t){const n=this.peek(),i=typeof t=="function"?t(n):n===t;return i&&this.inc(n),i}consumeWhile(t){const n=this.pos;for(;this.hasNext()&&this.consume(t););return this.pos!==n}substring(t,n=this.pos){return this.string.substring(t,n)}push(t){this.flushText(),this.tokens.push(t)}pushEmoji(t,n,i){this.textStart===-1&&(this.textStart=t);const r={from:t-this.textStart,to:n-this.textStart};i!=null&&(r.emoji=i),this.emoji.push(r),this.textEnd=n}hasFormat(t){return(this.format&t)===t}addFormat(t){this.format|=t}removeFormat(t){this.format^=this.format&t}consumeText(){this.textStart===-1&&(this.textStart=this.textEnd=this.pos);const t=this.next();t===f.SingleQuote?this.quote^=1:t===f.DoubleQuote&&(this.quote^=2),this.textEnd=this.pos}flushText(){if(this.hasPendingText()){const t={type:c.Text,format:this.options.useFormat?this.format:l.None,value:this.substring(this.textStart,this.textEnd),sticky:!1};this.emoji.length&&(t.emoji=this.emoji,this.emoji=[]),this.tokens.push(t),this.textStart=this.textEnd=-1}}hasQuote(t){return(this.quote&t)===t}atWordBound(){const{pos:t}=this;if(t===0||this.isAfterEmoji())return!0;if(this.hasPendingText())return G(this.peekPrev());const n=k(this.tokens);return n?n.type===c.Markdown||n.type===c.Newline:!1}isAfterEmoji(){var t;if(this.hasPendingText()){if(this.emoji.length&&k(this.emoji).to===this.textEnd-this.textStart)return!0}else{const n=k(this.tokens);if(n&&n.type===c.Text&&(t=n.emoji)!=null&&t.length)return k(n.emoji).to===n.value.length}return!1}markPending(t){this.hasPendingText()||(this.textStart=t),this.textEnd=this.pos}resetBrackets(){this.brackets.curly=this.brackets.round=this.brackets.square=0}inc(t){return this.pos+=t>65535?2:1,t}}function Xn(e){return e===f.SingleQuote?1:2}const Gn=new Set([8252,8265,8505,9e3,9167,9410,9654,9664,9742,9745,9752,9757,9760,9766,9770,9792,9794,9827,9832,9851,9881,9895,9928,9937,9981,9986,9989,9999,10002,10004,10006,10013,10017,10024,10052,10055,10060,10062,10071,10145,10160,10175,11088,11093,12336,12349,12951,12953]);function Ce(e){const{pos:t}=e;return!e.options.skipEmoji&&Jn(e)?(e.pushEmoji(t,e.pos),!0):!1}function Jn(e){return Qe(e)||Zn(e)||Yn(e)||ei(e)}function Qe(e){const{pos:t}=e;return e.consume(ni)&&(e.consume(65039),e.consume(8419))?!0:(e.pos=t,!1)}function Zn(e){const{pos:t}=e;if(e.consume(mt)&&e.consume(mt))return!0;if(e.consume(127988)&&e.consume(dt))for(;e.hasNext();){if(e.consume(917631))return!0;if(!e.consume(dt))break}return e.pos=t,!1}function Yn(e){const{pos:t}=e;for(;ti(e)&&e.consume(8205););return t!==e.pos?!0:(e.pos=t,!1)}function ei(e){const t=e.pos;return e.next()&&e.consume(65039)?!0:(e.pos=t,!1)}function ti(e){const t=e.pos;return e.consume(oi)?(e.consume(ii),e.consume(ri),e.consume(65039),!0):(e.pos=t,!1)}function ni(e){return e===f.Hash||e===f.Asterisk||C(e)}function mt(e){return e>=127462&&e<=127487}function ii(e){return e>=127995&&e<=127999}function dt(e){return e>=917536&&e<=917630}function ri(e){return e===9792||e===9794}function oi(e){return e===174||Gn.has(e)||e>=8596&&e<=8601||e>=8617&&e<=8618||e>=8986&&e<=8987||e>=9193&&e<=9203||e>=9208&&e<=9210||e>=9642&&e<=9643||e>=9723&&e<=9726||e>=9728&&e<=9732||e>=9748&&e<=9749||e>=9762&&e<=9763||e>=9774&&e<=9775||e>=9784&&e<=9786||e>=9800&&e<=9811||e>=9823&&e<=9824||e>=9829&&e<=9830||e>=9854&&e<=9855||e>=9874&&e<=9879||e>=9883&&e<=9884||e>=9888&&e<=9889||e>=9898&&e<=9899||e>=9904&&e<=9905||e>=9917&&e<=9918||e>=9924&&e<=9925||e>=9934&&e<=9935||e>=9939&&e<=9940||e>=9961&&e<=9962||e>=9968&&e<=9973||e>=9975&&e<=9978||e>=9992&&e<=9997||e>=10035&&e<=10036||e>=10067&&e<=10069||e>=10083&&e<=10084||e>=10133&&e<=10135||e>=10548&&e<=10549||e>=11013&&e<=11015||e>=11035&&e<=11036||e>=123904&&e<=7999||e>=124928&&e<=129023||e>=125952&&e<=130047}function Ve(e,t=!1){const n=new Map;return e.forEach(i=>qt(n,i,t)),n}function Ut(e,t,n=!1){const{pos:i}=e;let r=t,o,s;for(;e.hasNext();){if(o=e.next(),n&&(o=he(o)),s=r.get(o),s===!0)return!0;if(s===void 0)break;r=s}return e.pos=i,!1}function qt(e,t,n,i=0){let r=t.charCodeAt(i++);n&&(r=he(r)),i===t.length?e.set(r,!0):(e.has(r)||e.set(r,new Map),qt(e.get(r),t,n,i))}const Ht={":C":"☹️",":c":"☹️",":)":"🙂",":-)":"🙂","<3":"❤️",":(|)":"🐵",":(:)":"🐷","(]:{":"👳","</3":"💔","~@~":"💩",":D":"😀",":-D":"😀","^_^":"😁","=D":"😄",":-@":"😣",":-S":"😖","O:)":"😇","O=)":"😇","O:-)":"😇","}:)":"😈","}=)":"😈","}:-)":"😈",";)":"😉",";-)":"😉","=)":"🙂","^^":"😊","B-)":"😎",":,":"😏",":-,":"😏",":|":"😐","=|":"😐",":-|":"😐","-_-":"😑",u_u:"😔","=/":"😕",":-/":"😕",":-\\":"😕",":s":"😖",":-s":"😖",":*":"😗",":-*":"😗",";*":"😘",";-*":"😘","=*":"😚",":p":"😛",":P":"😛",":-p":"😛",":-P":"😛","=p":"😛","=P":"😛",";p":"😜",";P":"😜",";-p":"😜",";-P":"😜",":(":"🙁",":-(":"🙁","=(":"🙁",">:(":"😡",":'(":"😢","='(":"😢",T_T:"😭",";_;":"😭",">.<":"😣",">_<":"😣","D:":"😦",":o":"😮",":O":"😮","=o":"😮","=O":"😮",":-O":"😮",":-o":"😮","o.o":"😮","O.O":"😲",x_x:"😵","X(":"😵","X-(":"😵","X-o":"😵","X-O":"😵",":3":"😸","o/":"🙋","\\o":"🙋","\\m/":"🤘",":-$":"🤐",":$":"🤐","*-)":"😐",":-I":"😠",":I":"😠",":@":"😠","8oI":"😡","8o|":"😡","|-)":"😪","(ch)":"😏","(lo)":"😍","(sr)":"😔","|-(":"😴","(y)":"👍","(Y)":"👍","(n)":"👎","(N)":"👎","(H)":"😎","(hu)":"😬","(tr)":"😒","(md)":"😵","(fr)":"😄","(dt)":"😟","(sc)":"😕","(v)":"✌️","(L)":"❤️","(U)":"💔","(K)":"💋","(F)":"🌼","(*)":"⭐","(^)":"🎂","(G)":"🎁","(B)":"🍺","(D)":"🍸","(CC)":"🎂","(pi)":"🍕","(pl)":"🍴","(ic)":"🍦","($)":"💰","(co)":"💻","(so)":"⚽","(te)":"🎾","(nt)":"🎵","(I)":"💡","(E)":"✉️","(Z)":"👦","(X)":"👧","(S)":"🌙","(facepalm)":"🤦‍","^o)":"🤨",":S":"😵‍💫"},si=Ve(Object.keys(Ht));function Ne(e){if(e.options.textEmoji&&ui(e)){const{pos:t}=e;if(Ut(e,si)){const n=e.substring(t);return e.pushEmoji(t,e.pos,Ht[n]||n),!0}e.pos=t}return!1}function ui(e){if(e.options.textEmoji==="force")return!0;let t;if(e.hasPendingText()){const n=k(e.emoji);n!=null&&n.emoji&&n.to===e.textEnd&&(t=n)}else{const n=k(e.tokens);if((n==null?void 0:n.type)===c.Text&&n.emoji){const i=k(n.emoji);i!=null&&i.emoji&&i.to===n.value.length&&(t=i)}}return t?!0:e.atWordBound()}const pt=[35,117],gt=[115,35];function Wt(e){if(e.options.userSticker){const{pos:t}=e;if(se(e,pt)){for(;e.hasNext();)if(se(e,gt)){const n=e.substring(t);return e.push({type:c.UserSticker,format:l.None,value:n,stickerId:n.slice(pt.length,-gt.length)}),!0}else if(!e.consume(_t))break}e.pos=t}return!1}function Qt(e){if(e.options.mention&&e.atWordBound()){const{pos:t}=e,n=e.options.mention==="strict"?$n:ai;if(e.consume(f.At)&&(n(e)||G(e.peek()))){const i=e.substring(t);return e.push({type:c.Mention,format:l.None,value:i,mention:i.slice(1)}),!0}e.pos=t}return!1}function ai(e){return e.consumeWhile(li)}function li(e){return C(e)||We(e)||e===f.Underscore||e===f.Hyphen}function Vt(e){if(e.options.command&&ci(e.peekPrev())){const{pos:t}=e;if(e.consume(f.Slash)&&(e.consumeWhile($t)||G(e.peek()))){const n=e.substring(t);return e.push({type:c.Command,format:l.None,value:n,command:n.slice(1)}),!0}e.pos=t}return!1}function ci(e){return e!==e||fe(e)}function Kt(e){if(e.options.hashtag&&fi(e)){const{pos:t}=e;if(e.consume(f.Hash)&&(e.consumeWhile($t)||z(e.peek()))){const n=e.substring(t);return e.push({type:c.HashTag,format:l.None,value:n,hashtag:n.slice(1)}),!0}e.pos=t}return!1}function fi(e){if(e.atWordBound())return!0;if(!e.hasPendingText()){const t=k(e.tokens);return(t==null?void 0:t.type)===c.HashTag}return!1}const Z=new Map([[f.Asterisk,l.Bold],[f.Underscore,l.Italic],[f.Tilde,l.Strike],[f.BackTick,l.Monospace]]);function hi(e){if(e.options.markdown){const{pos:t}=e;return ki(e)||(di(e)?pi(e):gi(e)),e.pos!==t}return!1}function Ke(e){return Z.get(e)||l.None}function Xe(e){return z(e)||e===f.RoundBracketOpen||e===f.SquareBracketOpen||e===f.CurlyBracketOpen}function Ge(e){return G(e)||Fn(e)}function mi(e){if(!e.options.markdown)return!1;const{pos:t}=e;let n;for(;(n=Ke(e.peek()))&&e.hasFormat(n);)e.pos++;const i=t!==e.pos&&Xt(e);return e.pos=t,i}function di(e){if(e.pos===0)return!0;if(e.hasPendingText())return Xe(e.peekPrev());const t=k(e.tokens);return!!((t==null?void 0:t.type)===c.Markdown&&t.format&l.LinkLabel)}function Xt(e){return Ge(e.peek())}function pi(e){let t;for(;e.hasNext()&&(t=Ke(e.peek()),t!==l.None&&!e.hasFormat(t));)e.pos++,je(e,D(e,t))}function gi(e){const t=[],{pos:n}=e;let{format:i}=e,r;for(;e.hasNext()&&(r=Ke(e.peek()),r!==l.None&&i&r);)e.pos++,i&=~r,t.push(D(e,r));if(t.length&&Xt(e))for(let o=0;o<t.length;o++)Me(e,t[o]);else n!==e.pos&&e.markPending(n)}function D(e,t){return{type:c.Markdown,format:t,value:e.substring(e.pos-1)}}function je(e,t){e.push(t),e.format|=t.format,e.formatStack.push(t)}function Me(e,t){e.push(t),e.format&=~t.format;const n=yi(e,t);if(n){let i=e.tokens.length-2,r;for(;i>=0&&(r=e.tokens[i--],r.format|=t.format,r!==n););}}function yi(e,t){const n=e.formatStack;let i=n.length-1;for(;i>=0;){if(n[i].format&t.format)return n.splice(i,1)[0];i--}}function ki(e){const{pos:t}=e;if(e.consume(f.SquareBracketOpen))return je(e,D(e,l.LinkLabel)),!0;if(e.consume(f.SquareBracketClose)&&e.format&l.LinkLabel){const n=D(e,l.LinkLabel);if(e.consume(f.RoundBracketOpen)){const i=D(e,l.Link),r=e.pos;if(xi(e)){const o=e.substring(r);return Me(e,n),je(e,i),e.push({type:c.Link,format:e.format,value:o,link:o,auto:!1,sticky:!1}),e.pos++,Me(e,D(e,l.Link)),!0}}}return e.pos=t,!1}function xi(e){let t=2e3,n;const{pos:i}=e;for(;e.hasNext()&&--t;){if(n=e.peek(),n===f.RoundBracketClose)return!0;if(z(n))break;e.next()}return e.pos=i,!1}const bi=new Set(["abbott","abogado","ac","academy","accountant","accountants","active","actor","ad","ads","adult","ae","aero","af","afl","ag","agency","ai","airforce","al","allfinanz","alsace","am","amsterdam","an","android","ao","apartments","aq","aquarelle","ar","archi","army","arpa","as","asia","associates","at","attorney","au","auction","audio","autos","aw","ax","axa","az","ba","band","bank","bar","barclaycard","barclays","bargains","bauhaus","bayern","bb","bbc","bd","be","beer","berlin","best","bf","bg","bh","bi","bid","bike","bingo","bio","biz","bj","bl","black","blackfriday","bloomberg","blue","bm","bmw","bn","bnpparibas","bo","boats","bond","boo","boutique","bq","br","brussels","bs","bt","budapest","build","builders","business","buzz","bv","bw","by","bz","bzh","ca","cab","cafe","cal","camera","camp","cancerresearch","canon","capetown","capital","caravan","cards","care","career","careers","cartier","casa","cash","casino","cat","catering","cbn","cc","cd","center","ceo","cern","cf","cfd","cg","ch","channel","chat","cheap","chloe","christmas","chrome","church","ci","citic","city","ck","cl","claims","cleaning","click","clinic","clothing","club","cm","cn","co","coach","codes","coffee","college","cologne","com","community","company","computer","condos","construction","consulting","contractors","cooking","cool","coop","country","courses","cr","credit","creditcard","cricket","crs","cruises","cu","cuisinella","cv","cw","cx","cy","cymru","cyou","cz","dabur","dad","dance","date","dating","datsun","day","dclk","de","deals","degree","delivery","democrat","dental","dentist","desi","design","dev","diamonds","diet","digital","direct","directory","discount","dj","dk","dm","dnp","do","docs","doha","domains","doosan","download","durban","dvag","dz","eat","ec","edu","education","ee","eg","eh","email","emerck","energy","engineer","engineering","enterprises","epson","equipment","er","erni","es","esq","estate","et","eu","eurovision","eus","events","everbank","exchange","expert","exposed","express","fail","faith","fan","fans","farm","fashion","feedback","fi","film","finance","financial","firmdale","fish","fishing","fit","fitness","fj","fk","flights","florist","flowers","flsmidth","fly","fm","fo","foo","football","forex","forsale","foundation","fr","frl","frogans","fund","furniture","futbol","ga","gal","gallery","garden","gb","gbiz","gd","gdn","ge","gent","gf","gg","ggee","gh","gi","gift","gifts","gives","gl","glass","gle","global","globo","gm","gmail","gmo","gmx","gn","gold","goldpoint","golf","goo","goog","google","gop","gov","gp","gq","gr","graphics","gratis","green","gripe","gs","gt","gu","guge","guide","guitars","guru","gw","gy","hamburg","hangout","haus","healthcare","help","here","hermes","hiphop","hiv","hk","hm","hn","holdings","holiday","homes","horse","host","hosting","house","how","hr","ht","hu","ibm","id","ie","ifm","il","im","immo","immobilien","in","industries","infiniti","info","ing","ink","institute","insure","int","international","investments","io","iq","ir","irish","is","it","iwc","java","jcb","je","jetzt","jm","jo","jobs","joburg","jp","juegos","kaufen","kddi","ke","kg","kh","ki","kim","kitchen","kiwi","km","kn","koeln","komatsu","kp","kr","krd","kred","kw","ky","kyoto","kz","la","lacaixa","land","lat","latrobe","lawyer","lb","lc","lds","lease","leclerc","legal","lgbt","li","lidl","life","lighting","limited","limo","link","lk","loan","loans","london","lotte","lotto","love","lr","ls","lt","ltda","lu","luxe","luxury","lv","ly","ma","madrid","maif","maison","management","mango","market","marketing","markets","marriott","mc","md","me","media","meet","melbourne","meme","memorial","menu","mf","mg","mh","miami","mil","mini","mk","ml","mm","mma","mn","mo","mobi","moda","moe","monash","money","mormon","mortgage","moscow","motorcycles","mov","movie","mp","mq","mr","ms","msk","mt","mtn","mtpc","mu","museum","mv","mw","mx","my","mz","na","nagoya","name","navy","nc","ne","net","network","neustar","new","news","nexus","nf","ng","ngo","nhk","ni","nico","ninja","nissan","nl","no","np","nr","nra","nrw","ntt","nu","nyc","nz","okinawa","om","one","ong","onl","online","ooo","org","organic","osaka","otsuka","ovh","pa","page","panerai","paris","partners","parts","party","pe","pf","pg","ph","pharmacy","photo","photography","photos","physio","piaget","pics","pictet","pictures","pink","pizza","pk","pl","place","plumbing","plus","pm","pn","pohl","poker","porn","post","pr","praxi","press","pro","prod","productions","prof","properties","property","ps","pt","pub","pw","py","qa","qpon","quebec","racing","re","realtor","recipes","red","redstone","rehab","reise","reisen","reit","ren","rentals","repair","report","republican","rest","restaurant","review","reviews","rich","rio","rip","ro","rocks","rodeo","rs","rsvp","ru","ruhr","rw","ryukyu","sa","saarland","sale","samsung","sap","sarl","saxo","sb","sc","sca","scb","schmidt","scholarships","school","schule","schwarz","science","scot","sd","se","services","sew","sexy","sg","sh","shiksha","shoes","shriram","si","singles","site","sj","sk","sky","sl","sm","sn","so","social","software","sohu","solar","solutions","soy","space","spiegel","spreadbetting","sr","ss","st","study","style","su","sucks","supplies","supply","support","surf","surgery","suzuki","sv","sx","sy","sydney","systems","sz","taipei","tatar","tattoo","tax","tc","td","team","tech","technology","tel","temasek","tennis","tf","tg","th","tickets","tienda","tips","tires","tirol","tj","tk","tl","tm","tn","to","today","tokyo","tools","top","toshiba","tours","town","toys","tp","tr","trade","trading","training","travel","trust","tt","tui","tv","tw","tz","ua","ug","uk","um","university","uno","uol","us","uy","uz","va","vacations","vc","ve","vegas","ventures","versicherung","vet","vg","vi","viajes","video","villas","vision","vlaanderen","vn","vodka","vote","voting","voto","voyage","vu","wales","wang","watch","webcam","website","wed","wedding","wf","whoswho","wien","wiki","williamhill","win","wme","work","works","world","ws","wtc","wtf","xin","测试","परीक्षा","佛山","慈善","集团","在线","한국","ভারত","八卦","موقع","বাংলা","公益","公司","移动","我爱你","москва","испытание","қаз","онлайн","сайт","срб","бел","时尚","테스트","淡马锡","орг","삼성","சிங்கப்பூர்","商标","商店","商城","дети","мкд","טעסט","中文网","中信","中国","中國","谷歌","భారత్","ලංකා","測試","ભારત","भारत","آزمایشی","பரிட்சை","网店","संगठन","网络","укр","香港","δοκιμή","飞利浦","إختبار","台湾","台灣","手机","мон","الجزائر","عمان","ایران","امارات","بازار","پاکستان","الاردن","بھارت","المغرب","السعودية","سودان","عراق","مليسيا","政府","شبكة","გე","机构","组织机构","健康","ไทย","سورية","рус","рф","تونس","みんな","グーグル","世界","ਭਾਰਤ","网址","游戏","vermögensberater","vermögensberatung","企业","信息","مصر","قطر","广东","இலங்கை","இந்தியா","հայ","新加坡","فلسطين","テスト","政务","xxx","xyz","yachts","yandex","ye","yodobashi","yoga","yokohama","youtube","yt","za","zip","zm","zone","zuerich","zw","xn--p1ai"]),wi=63,Gt=43,vi=new Set(O("$-_.+")),Ei=new Set(O(`!*"'()[],|`)),Si=new Set(O("!,.:;?")),Ti=O("mailto:",!0),Li=O("magnet:",!0),Ci=new Set(O(";?&=:")),Ni=new Set(O("!$%&*+=^`{|}~")),ji=Ve(["skype://","http://","https://","tamtam://","tt://","tg://","ftp://","contact://","//"],!0);function Jt(e,t=ji){if(e.options.link&&e.atWordBound()){const{pos:n}=e,i=Ri(e)||Mi(e)||Bi(e,t)||Ai(e);return i===0?(e.pos=n,!1):(i===2&&e.markPending(n),!0)}return!1}function Mi(e){const{pos:t}=e;return se(e,Ti,!0)?Zt(e,de(e),t)?1:2:0}function Bi(e,t){let{pos:n}=e;const i=n;if(Ut(e,t,!0)){const r=Pi(e);if(de(e,Gt)){Yt(e),en(e),pe(e),tn(e);const o=e.substring(i);return e.push(ge(o,/^\/\//.test(o)?`http:${o}`:o)),1}else if(!r)return 2;n=e.pos}return 0}function Ai(e){const{pos:t}=e;let n=de(e);if(Zt(e,n,t))return 1;if(ue(n,64)&&Ze(n,128)){for(;sn(e.peekPrev());)e.pos--;n&=-69}return Oi(e,n,t)?1:n?2:0}function Ri(e){const{pos:t}=e;if(se(e,Li,!0)){pe(e);const n=e.substring(t);return e.push(ge(n,n)),1}return 0}function Zt(e,t,n){if($i(t)&&e.consume(f.At)){const i=de(e,Gt);if(on(i)){pe(e);const r=e.substring(n);return e.push(ge(r,/^mailto:/i.test(r)?r:`mailto:${r}`)),!0}e.pos--}return!1}function Oi(e,t,n){if(on(t)){Yt(e),en(e),pe(e),tn(e);const i=e.substring(n);return e.push(ge(i,/^[a-z0-9+-]+:/i.test(i)?i:`http://${i}`)),!0}return!1}function de(e,t=4294967295){const n=e.pos;let i=0,r=n,o=n,s,u=!1;const a=t&2,h=t&1,m=t&4,p=t&8,g=t&32;for(;e.hasNext();){if(s=e.pos,Qe(e)||mi(e)){e.pos=s;break}if(m&&e.consume(sn))i|=4,u=!0;else{if(a&&e.consume(f.Dot)){if(G(e.peek())){e.pos--;break}if(s===r){e.pos=s;break}r=e.pos,i|=2}else if(h&&e.consume(zi))i|=1;else if(p&&e.consume(We))i|=8;else break;o=e.pos,u===!0&&(u=!1,i|=128),e.pos-r>wi&&(i|=16)}}return g&&r!==n&&bi.has(e.substring(r,o).toLowerCase())&&(i|=32),u&&(i|=64),i}function Yt(e){const{pos:t}=e;if(e.consume(f.Colon)){let n=0;for(;e.hasNext();){if(n=e.pos,Qe(e)){e.pos=n;break}if(!e.consume(C))break}}return e.pos-t>1?!0:(e.pos=t,!1)}function en(e){const{pos:t}=e;return e.resetBrackets(),e.consume(f.Slash)&&Je(e),e.pos!==t}function pe(e){const{pos:t}=e;return e.consume(f.Question)&&!rn(e)?(e.resetBrackets(),Je(e),!0):(e.pos=t,!1)}function tn(e){return e.consume(f.Hash)?(e.resetBrackets(),Je(e),!0):!1}function Pi(e){const{pos:t}=e;for(;Fi(e)||e.consumeWhile(Qi););return t!==e.pos&&e.consume(f.At)?!0:(e.pos=t,!1)}function Je(e){let{pos:t}=e;const n=t;let i,r;for(;e.hasNext();)if(t=e.pos,r=e.peek(),It(r)){if(nn(e,r))break;e.next()}else if(e.consume(un)){if(z(e.peek())){e.pos=t;break}}else if(i=qi(e)){if(i===2)break}else if(!e.consume(Di))break;return n!==e.pos}function Di(e){return e>0&&e===e&&e!==f.Question&&e!==f.Hash&&e!==f.SingleQuote&&e!==f.DoubleQuote&&!fe(e)&&!Ft(e)}function Fi(e){return _i(e)||Ii(e)}function _i(e){const{pos:t}=e;return e.consume(f.Percent)&&e.consume(yt)&&e.consume(yt)?!0:(e.pos=t,!1)}function Ii(e){return nn(e,e.peek())?!1:e.consume(Ui)}function nn(e,t){return It(t)?e.hasQuote(Xn(t)):!1}function ue(e,t){return(e&t)===t}function Ze(e,t){return(e&t)===0}function rn(e){const t=e.peek();return z(t)||un(t)}function $i(e){return Ze(e,24)&&(ue(e,1)||ue(e,4))}function on(e){return Ze(e,20)&&ue(e,34)&&(e&9)!==0}function zi(e){return e===f.Hyphen||e===f.Underscore||J(e)||C(e)}function sn(e){return Ni.has(e)}function Ui(e){return We(e)||C(e)||vi.has(e)||Ei.has(e)}function yt(e){return C(e)?!0:(e&=-33,e>=65&&e<=70)}function un(e){return Si.has(e)}function qi(e){const t=e.peek(),n=Hi(t);if(n){const{pos:i}=e;return e.pos++,Wi(t)?(e.brackets[n]++,1):e.brackets[n]>0?(e.brackets[n]--,1):rn(e)?(e.pos=i,2):1}return 0}function Hi(e){switch(e){case f.CurlyBracketOpen:case f.CurlyBracketClose:return"curly";case f.RoundBracketOpen:case f.RoundBracketClose:return"round";case f.SquareBracketOpen:case f.SquareBracketClose:return"square"}}function Wi(e){return e===f.CurlyBracketOpen||e===f.RoundBracketOpen||e===f.SquareBracketOpen}function Qi(e){return Ci.has(e)}function ge(e,t){return{type:c.Link,format:l.None,value:e,link:t,auto:!0,sticky:!1}}function Vi(e){const{pos:t}=e;if(an(e)){const n=e.substring(t);return e.push({type:c.Newline,format:l.None,value:n}),!0}}function an(e){return e.consume(f.Return)?(e.consume(f.NewLine),!0):e.consume(f.NewLine)||e.consume(f.LineFeed)}function w(e,t){const n=y(Dt,t),i=new zt(e,n),{linkProtocols:r}=n;let o;for(r&&(o=Array.isArray(r)?Ve(r,!0):r);i.hasNext();)hi(i)||Vi(i)||Ce(i)||Ne(i)||Wt(i)||Qt(i)||Vt(i)||Kt(i)||Jt(i,o)||i.consumeText();i.flushText();let{tokens:s}=i;if(n.markdown&&i.formatStack.length){for(let u=0,a;u<i.formatStack.length;u++)a=i.formatStack[u],a.format=l.None,a.type=c.Text;s=E(s)}return s}function R(e,t,n="end",i){if(t<0)return{index:-1,offset:-1};const r=e.findIndex((s,u)=>{const a=s.value.length;if(t<a)return!0;if(a===t){if(e.length-1===u)return!0;const h=e[u+1];if(!Gi(h)&&n==="end")return!0}t-=a}),o={offset:t,index:r};if(r!==-1){const s=e[r];if(i&&ln(s))o.offset=n==="end"?s.value.length:0;else if(s.emoji){const{emoji:u}=s;for(let a=0;a<u.length&&u[a].from<o.offset;a++)if(u[a].to>o.offset){o.offset=n==="start"?u[a].from:u[a].to;break}}}return o}function ye(e,t,n,i=!1){const r=R(e,t,"start",i),o=R(e,n,"end",i);return o.index<r.index&&t===n?[o,o]:o.index<r.index&&t===n?[o,o]:[r,o]}function L(e,t){if(t=Ye(t,0,e.value.length),t===0)return[Ae(""),e];if(t===e.value.length)return[e,Ae("")];let n=Be(e,t);return!U(n)&&t>0&&(n=ke(n)),[Be(e,0,t),n]}function Be(e,t,n=e.value.length){const{value:i,emoji:r}=e,o=y(e,{value:i.slice(t,n),emoji:Ki(r,t,n)});return o.type===c.Link&&(o.auto=!1),o}function Ki(e,t,n){if(!e)return;const i=[];for(let r=0;r<e.length;r++){const o=e[r];if(o.from>=n)break;o.from>=t&&o.to<=n&&i.push(o)}return i.length?Xi(i,-t):void 0}function ln(e){return e.type===c.Command||e.type===c.HashTag||e.type===c.UserSticker||e.type===c.Mention||e.type===c.Link&&!U(e)}function U(e){return e.type===c.Link&&!e.auto}function cn(e){return e.type===c.Link&&e.auto}function Xi(e,t){return e.map(n=>y(n,{from:n.from+t,to:n.to+t}))}function Ye(e,t,n){return Math.min(Math.max(e,t),n)}function ke(e,t){return t===void 0&&(t="sticky"in e?e.sticky:!1),{type:c.Text,format:e.format,value:e.value,emoji:e.emoji,sticky:t}}function fn(e,t,n){return n===void 0&&(n="sticky"in e?e.sticky:!1),{type:c.Link,format:e.format,value:e.value,emoji:e.emoji,link:t,auto:!1,sticky:n}}function Ae(e,t=0,n=!1,i){return{type:c.Text,format:t,value:e,emoji:i,sticky:n}}function Gi(e){return"sticky"in e&&e.sticky}function Re(e,t=0,n){return e.slice().sort((r,o)=>r.from-o.from).map(r=>{const o=t+r.from,s=r.emojiData||null,u=n&&n.slice(r.from,r.to);return{pos:o,data:s,hint:u}})}function Ji(e){const t=window.getSelection(),n=t.rangeCount&&t.getRangeAt(0);if(n&&Yi(n,e))return n}function H(e,t,n){const i=Zi(e,t,n);if(i)return hn(i)}function hn(e){const t=window.getSelection();try{if(t.rangeCount){const n=t.getRangeAt(0),i=n.compareBoundaryPoints(Range.START_TO_START,e),r=n.compareBoundaryPoints(Range.END_TO_END,e);if(i===0&&r===0)return}}catch{}return t.removeAllRanges(),t.addRange(e),e}function x(e){const t=Ji(e);if(t)return et(e,t)}function et(e,t){const{collapsed:n}=t,i=kt(e,t.startContainer,t.startOffset),r=n?i:kt(e,t.endContainer,t.endOffset);return[i,r]}function Zi(e,t,n){const i=bt(e,t),r=n==null||n===t?i:bt(e,n);if(i&&r){const o=document.createRange();return o.setStart(i.container,i.offset),o.setEnd(r.container,r.offset),o}}function kt(e,t,n){let i=0;if(e===t){n=Ye(n,0,e.childNodes.length);for(let r=0;r<n;r++)i+=wt(e.childNodes[r])}else if(er(e))for(let r=0;r<e.childNodes.length;r++){const o=e.childNodes[r];if(o.contains(t)){i+=nt(o),i+=o===t?tt(o,n):xt(o,t,n);break}i+=wt(o)}else n>0&&$(t)&&(i+=V(t).length),i+=xt(e,t,n);return i}function xt(e,t,n){let i=0;const r=He(e);let o;for(;(o=r.nextNode())&&o!==t;)i+=xe(o,!1);return i+=ce(t)?n:tt(t,n),i}function bt(e,t){for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];if(t-=nt(i),t<=0)return{container:i,offset:0};const r=He(i);let o,s;for(;s=r.nextNode();)if(o=xe(s,!1),o!==0){if(t<=o){if(ce(s))return{container:s,offset:t};if(t===0)return{container:s,offset:0};let u=t===0?0:1,a=s;for(;a=a.previousSibling;)u++;return{container:s.parentNode,offset:u}}t-=o}}return{container:e,offset:e.childNodes.length}}function tt(e,t){let n=0;t=Ye(t,0,e.childNodes.length);for(let i=0;i<t;i++)n+=xe(e.childNodes[i],!0);return n}function wt(e){return nt(e)+tt(e,e.childNodes.length)}function xe(e,t=!1){if(ce(e))return e.nodeValue.length;let n=0;if($(e)&&(n=V(e).length,t))for(let i=0;i<e.childNodes.length;i++)n+=xe(e.childNodes[i],!0);return n}function nt(e){return e.previousSibling?V(e).length||1:0}function Yi(e,t){return t.contains(e.commonAncestorContainer)}function er(e){const t=e.firstChild;return t&&$(t)?t.nodeName==="DIV"||t.nodeName==="P":!1}const tr=[[l.Bold,"bold"],[l.Italic,"italic"],[l.Monospace,"monospace"],[l.Strike,"strike"],[l.Underline,"underline"],[l.Heading,"heading"],[l.Marked,"marked"],[l.Highlight,"highlight"],[l.Link,"md-link"],[l.LinkLabel,"md-link-label"]],te={[c.Command]:"command",[c.HashTag]:"hashtag",[c.Link]:"link",[c.Markdown]:"md",[c.Mention]:"mention",[c.Text]:"",[c.UserSticker]:"user-sticker",[c.Newline]:"newline"},vt={fixTrailingLine:!1,replaceTextEmoji:!1,link:lr};function nr(e,t,n){const i=n?y(vt,n):vt;if(i.inline){ir(e,t,i);return}const r=new Pe(e,i),o=()=>r.elem("div"),s=new Pe(o(),i),u=()=>{s.pos===0&&s.elem("br"),s.trim()};s.container.removeAttribute("data-raw");for(let a=0;a<t.length;a++){const h=t[a];h.type===c.Newline?(u(),s.prepare(o()),s.container.setAttribute("data-raw",h.value)):a=mn(t,a,s)}u(),r.trim()}function ir(e,t,n){const i=new Pe(e,n);i.enter(i.elem("span"));for(let r=0;r<t.length;r++)r=mn(t,r,i);i.exit(),i.trim()}function mn(e,t,n){const i=e[t];if(!i.value)return t;const r=gn(e,t);if(r!==t){const o=i.format;for(n.enter(St(i,n));t<=r;){const s=e[t];if(s.format===o)Oe(s,n);else{const u=n.elem("span");u.className=dn(s.format),Et(u,s,n)}t++}return n.exit(),r}if(i.type===c.Newline)n.text(i.value);else if(yn(i))Oe(i,n);else{const o=St(i,n);i.type!==c.UserSticker&&Et(o,i,n)}return t}function Et(e,t,n){n.enter(e),Oe(t,n),n.exit()}function Oe(e,t){let{emoji:n}=e,{value:i}=e;const{options:r}=t;if(r.nowrap&&(i=i.replace(/\r\n?/g,`
`).replace(/[\s\n]/g," ")),n&&r.emoji){let o=0;(!r.replaceTextEmoji||e.format&l.Monospace)&&(n=n.filter(sr)),n.forEach(u=>{const a=i.slice(o,u.from),h=i.slice(u.from,u.to),m=u.emoji||h;a&&t.text(a),t.emoji(m,h,u.emojiData),o=u.to});const s=i.slice(o);s&&t.text(s)}else t.text(i)}function dn(e){let t="",n="";return tr.forEach(([i,r])=>{e&i&&(t+=n+r,n=" ")}),t}function rr(e){let t="",n="";return e.forEach(i=>{i&&(t+=n+i,n=" ")}),t}function be(e,t,n){const i=e.childNodes[n];return i?e.insertBefore(t,i):e.appendChild(t),t}function we(e,t){t&&pn(e)&&ar(e,t),e.remove()}class Pe{constructor(t,n){this.container=t,this.options=n,this.pos=0,this.stack=[]}text(t){let n=this.container.childNodes[this.pos];return(n==null?void 0:n.nodeType)===3?n.nodeValue!==t&&(n.nodeValue=t):(n=document.createTextNode(t),be(this.container,n,this.pos)),this.pos++,n}elem(t){let n=this.container.childNodes[this.pos];return(!pn(n)||n.localName!==t)&&(n=document.createElement(t),be(this.container,n,this.pos)),this.pos++,n}emoji(t,n,i){const{emoji:r}=this.options,o=this.container.childNodes[this.pos],s=o?ae(o):!1,u=r(t,s?o:null,n,i);if(u)return o!==u&&(be(this.container,u,this.pos),s&&we(o,r)),ur(u),u.setAttribute("data-raw",n),this.pos++,u;s&&we(o,r)}save(){this.stack.push([this.container,this.pos])}enter(t){this.save(),this.prepare(t)}exit(){this.trim(),this.restore()}restore(){const t=this.stack.pop();t&&(this.container=t[0],this.pos=t[1])}trim(){const{emoji:t}=this.options;for(;this.pos<this.container.childNodes.length;)we(this.container.childNodes[this.pos],t)}prepare(t){this.container=t,this.pos=0}}function pn(e){return(e==null?void 0:e.nodeType)===1}function gn(e,t){const n=e[t];for(;t<e.length-1&&or(n,e[t+1]);)t++;return t}function or(e,t){return e===t?!0:e.type===t.type?e.type===c.Link&&e.link===t.link||e.type===c.Mention&&e.mention===t.mention||e.type===c.HashTag&&e.hashtag===t.hashtag:!1}function St(e,t){let n;return it(e)?(n=t.elem("a"),n.setAttribute("href",t.options.link(e)),n.setAttribute("target","_blank"),n.addEventListener("mouseenter",hr),n.addEventListener("mouseleave",mr)):e.type===c.UserSticker&&t.options.emoji?n=t.emoji(e.value,e.value):n=t.elem("span"),n.className=rr([cr(e),dn(e.format)]),n}function sr(e){return e.emoji===void 0}function ae(e){return e.nodeType===1?e.hasAttribute("data-emoji"):!1}function ur(e){e.setAttribute("data-emoji","")}function ar(e,t){const n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT);let i;for(;i=n.nextNode();)ae(i)&&t(null,i);ae(e)&&t(null,e)}function lr(e){return e.type===c.HashTag?e.value:e.type===c.Link?e.link:""}function cr(e){if(cn(e)&&e.format&l.Monospace||fr(e)&&e.value.length===1)return"";if(it(e)){let{type:t}=e;return U(e)&&e.link[0]==="@"&&(t=c.Mention),t!==c.Link?`${te.link} ${te[t]}`:te[t]}return te[e.type]}function it(e){return e.format&l.Monospace?e.type===c.Link&&(!e.auto||/^[a-z+]+:\/\//i.test(e.value)):e.type===c.Mention?e.value.length>1:e.type===c.Link}function fr(e){return e.type===c.Mention||e.type===c.Command||e.type===c.HashTag}function yn(e){return e.type===c.Text&&e.format===l.None}function hr(e){rt(e.target,"linkenter")}function mr(e){rt(e.target,"linkleave")}function rt(e,t,n){e.dispatchEvent(new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:n}))}const dr={compactActions:[],compactTimeout:600,maxEntries:100};class pr{constructor(t){this._stack=[],this._ptr=-1,this.options=y(dr,t)}push(t,n,i,r=Date.now()){const{canRedo:o}=this;this._stack.length>this._ptr+1&&(this._stack=this._stack.slice(0,this._ptr+1));const s=this._stack[this._ptr],u={state:t,time:r,action:n,range:i};if(s&&n&&!o&&s.action===n&&this.options.compactActions.includes(n)&&r-s.time<this.options.compactTimeout)gr(s,u);else for(this._stack.push(u),this._ptr++;this._stack.length>this.options.maxEntries;)this._stack.shift(),this._ptr--}get canUndo(){return this._ptr>0}get canRedo(){return this._ptr<this._stack.length-1}get current(){return this._stack[this._ptr]}undo(){if(this.canUndo)return this._stack[--this._ptr]}redo(){if(this.canRedo)return this._stack[++this._ptr]}entries(){return this._stack.map(t=>t.state)}saveCaret(t){const{current:n}=this;n&&(n.caret=t)}clear(){this._stack=[],this._ptr=-1}}function gr(e,t){return e.time=t.time,e.state=t.state,e.range&&t.range&&(e.range=[Math.min(e.range[0],t.range[0]),Math.max(e.range[1],t.range[1])]),e}const ne=Array.from(Z.values()),De=new Map;Z.forEach((e,t)=>De.set(e,String.fromCharCode(t)));function Fe(e,t){const n={offset:0,range:t},i=[];let r=l.None;for(let o=0,s,u;o<e.length;o++)if(s=e[o],u=s.value.length,s.type===c.Markdown)if(s.format&l.LinkLabel){const a=wr(e,o);br(e.slice(o,a),i,n),o=a-1}else{if(r&Z.get(s.value.charCodeAt(0))){const a=i[i.length-1];(!a||!(a.format&s.format))&&((a.type===c.Text||a.type===c.Link)&&a.sticky?a.format|=s.format:i.push({type:c.Text,format:r,value:"",sticky:!0})),r&=~s.format}else r|=s.format;$e(n,s)}else n.offset+=u,i.push(s);return i}function _e(e,t){const n={format:0,stack:[],range:t,link:"",output:""};return e.forEach(i=>yr(i,n)),n.format&&W(n,Ie(n.format,n,!0),!1),n.output}function yr(e,t){let n="",{format:i}=e,r=l.None,o=0,s=0,u=!1,a;U(e)&&(i|=l.Link,n=e.link,t.link&&e.link!==t.link&&(r=l.Link));const h=t.format^i,m=t.format&h|r,p=i&h|r;m&&(o=m&l.Link,s=o?t.output.length:kr(t.output),u=s!==t.output.length,a=t.output.slice(s),t.output=t.output.slice(0,s),W(t,Ie(m,t,!0),!1),t.output+=a,!p&&!o&&!u&&!Ge(e.value.charCodeAt(0))&&W(t," ",!1)),p?(o=p&l.Link,o?(s=0,t.link=n):s=xr(e.value),s===0&&e.value&&!o&&!Xe(t.output.charCodeAt(t.output.length-1))&&W(t," ",!0),t.output+=e.value.slice(0,s),W(t,Ie(p,t,!1),!0),t.output+=e.value.slice(s)):t.output+=e.value,t.format=i}function kr(e){let t=e.length,n;for(;t>0&&(n=e.charCodeAt(t-1),!(!Ge(n)||Z.has(n)));)t--;return t}function xr(e){let t=0;for(;t<e.length&&Xe(e.charCodeAt(t));)t++;return t}function Ie(e,t,n){let i="";const{stack:r}=t;if(n){for(let o=r.length-1;o>=0;o--)e&r[o]&&(i+=De.get(r[o]),r.splice(o,1));e&l.Link&&t.link&&(i+=`](${t.link})`,t.link="")}else{e&l.Link&&(i+="[");for(let o=0;o<ne.length;o++)e&ne[o]&&(r.push(ne[o]),i+=De.get(ne[o]))}return i}function br(e,t,n){if(e.length){const r=e[e.length-2].value;e.slice(0,-4).forEach(o=>{o.type===c.Markdown?$e(n,o):(t.push({type:c.Link,format:o.format&~l.LinkLabel,value:o.value,auto:!1,emoji:o.emoji,link:r,sticky:!1}),n.offset+=o.value.length)}),n.range&&e.slice(-4).forEach(o=>$e(n,o))}}function wr(e,t){let n=!1,i;for(;t<e.length;)if(i=e[t++],i.type===c.Markdown&&i.format&l.Link){if(n)return t;n=!0}}function $e(e,t){const{range:n,offset:i}=e;if(n){if(i<n[0])n[0]-=t.value.length;else if(i<n[0]+n[1]){const r=i-n[0];e.range[1]=r+Math.max(0,n[1]-r-t.value.length)}}}function W(e,t,n){const{range:i}=e;if(i){const r=e.output.length;r<i[0]||r===i[0]&&n?i[0]+=t.length:r<i[0]+i[1]&&(i[1]+=t.length)}e.output+=t}function vr(e,t,n,i){return ot(e,n,t,t,i)}function Er(e,t,n,i,r){return ot(e,i,t,t+n,r)}function kn(e,t,n,i){return ot(e,"",t,t+n,i)}function Sr(e,t,n,i){return{cut:E(K(e,t,n)),tokens:kn(e,t,n-t,i)}}function Tr(e,t){const{index:n}=R(e,t);return n!==-1?e[n].format:0}function _(e,t,n,i=0,r){if(!e.length)return[Ae("",ze(0,t),!0)];const[o,s]=ye(e,n,n+i,!r);if(o.index===-1||s.index===-1||s.index<o.index)return e;const u=e[o.index];if(s.index===o.index)s.offset===o.offset?e=ie(e,o.index,t,o.offset,0):e=ie(e,o.index,t,o.offset,s.offset-o.offset);else{e=e.slice();for(let a=o.index+1,h;a<s.index;a++)h=ze(e[a].format,t),e[a].format!==h&&(e[a]=y(e[a],{format:h}));s.offset!==0&&(e=ie(e,s.index,t,0,s.offset)),o.offset<u.value.length&&(e=ie(e,o.index,t,o.offset,u.value.length-o.offset))}return E(e)}function K(e,t,n){if(!e.length)return[];const i=A(e);if(n==null?n=i:n<0&&(n+=i),t<0&&(t+=i),t<0||t>i||n<0||n>i||n<t)return console.warn(`Invalid range: ${t}:${n}. Max length: ${i}`),[];if(t===n)return[];const[r,o]=ye(e,t,n);if(r.index===o.index){const a=e[r.index];return r.offset===0&&o.offset===a.value.length?[a]:[ve(Be(e[r.index],r.offset,o.offset))]}const[,s]=L(e[r.index],r.offset),[u]=L(e[o.index],o.offset);return E([ve(s),...e.slice(r.index+1,o.index),ve(u)])}function I(e,t,n,i=0,r){const[o,s]=ye(e,n,n+i);if(o.index===-1||s.index===-1)return console.warn("Invalid range:",{pos:n,len:i}),e;let u;const a=e.slice();for(let h=o.index+1;h<s.index;h++)a[h]=re(a[h],t,r);if(o.index===s.index){u=a[o.index];const[h,m]=L(u,o.offset),[p,g]=L(m,s.offset-o.offset),S=re(p,t,r);a.splice(o.index,1,h,S,g)}else{let h,m;u=a[s.index],[h,m]=L(u,s.offset),a.splice(s.index,1,re(h,t,r),m),u=a[o.index],[h,m]=L(u,o.offset),a.splice(o.index,1,h,re(m,t,r))}return E(a)}function Lr(e,t,n,i){return st(e,n,t,t,i)}function Cr(e,t,n,i,r){return st(e,i,t,t+n,r)}function xn(e,t,n,i){return st(e,"",t,t+n,i)}function Nr(e,t,n,i){return{cut:w(me(e).slice(t,n),i),tokens:xn(e,t,n-t,i)}}function bn(e,t){const n=e.slice();return t=t.sort((i,r)=>i.pos-r.pos),t.forEach(i=>{var u;const r=R(n,i.pos,"start");if(r.index===-1||r.offset===-1)return;const o=n[r.index],s=(u=o.emoji)==null?void 0:u.find(a=>a.from===r.offset);if(s){if(i.hint){const a=o.value.slice(s.from,s.to);if(i.hint!==a)return}i.data?s.emojiData=i.data:s.emojiData&&delete s.emojiData}}),n}function jr(e,t,n,i,r,o,s=0){var N,q;const u=[];for(let d=0;d<((N=t.emoji)==null?void 0:N.length);d++){const j=t.emoji[d];if(j.from<n)u.push(j);else break}const a=Re(u,s,t.value),h=[];for(let d=(((q=i.emoji)==null?void 0:q.length)||0)-1;d>=0;d--){const j=i.emoji[d];if(j.from>=r)h.push(j);else break}const m=R(e,o,"start"),g=me(e.slice(0,m.index)).length+m.offset-r,S=Re(h,g,i.value);return bn(e,[...a,...S])}function ot(e,t,n,i,r){if(!e.length)return w(t,r);const[o,s]=ye(e,n,i);if(o.index===-1||s.index===-1)return console.warn("Invalid location:",{from:n,to:i,start:o,end:s}),e;const u=e.slice(0,o.index),a=e.slice(s.index+1),h=e[s.index];let m=e[o.index],p=o.offset+t.length,g=m.value.slice(0,o.offset)+t+h.value.slice(s.offset);const S={...o},N=m;let q=0;m.type===c.Text&&o.index>0&&cn(e[o.index-1])&&(m=u.pop(),g=m.value+g,p+=m.value.length,o.index--,o.offset=0,q=m.value.length);let d=w(g,r);if(d.length){if(d.forEach(T=>T.format=m.format),d=jr(d,N,S.offset,h,s.offset,p,q),m.format!==h.format){const T=R(d,p);T.index!==-1&&p!==g.length&&d.slice(T.index).every(M=>M.type===c.Text)&&(d=_(d,h.format,p,g.length-p))}const j=o.offset===0&&i-n>m.value.length;if(U(m)&&!j){const{link:T}=m;let M;if(o.offset===m.value.length){let P=o.offset;const ee=e[o.index+1];if((ee==null?void 0:ee.type)===c.Link&&ee.link===m.link)P+=t.length;else if(m.sticky){const ft=t.match(/[\s.,!?:;]/);ft?(P+=ft.index||0,M=!1):(P+=t.length,M=!0)}d=I(d,T,0,P,M)}else o.offset===0&&n===i?d=I(d,T,t.length,m.value.length):(r!=null&&r.stickyLink&&i-n>=m.value.length&&(M=!0),d=d.map(P=>fn(P,T,M)))}}return E([...u,...d,...a])}function st(e,t,n,i,r){const o=me(e),s=o.slice(0,n)+t+o.slice(i);return w(s,r)}function ie(e,t,n,i,r){const o=e[t],s=ze(o.format,n);if(o.format===s)return e;let u;if(i===0&&r===o.value.length)u=[y(o,{format:s})];else{const[a,h]=L(o,i),[m,p]=L(h,r);m.format=s,u=[a,m,p],ln(o)&&(u=u.map(g=>ke(g))),u[1].sticky=r===0}return E([...e.slice(0,t),...u,...e.slice(t+1)])}function ze(e,t){return typeof t=="number"?t:(t.add&&(e|=t.add),t.remove&&(e&=~t.remove),e)}function re(e,t,n){return t?fn(e,t,n):ke(e)}function ve(e){if(e.type===c.Link){if(!e.auto)return e;const t=w(e.value,{link:!0})[0];return t.format=e.format,t}return ke(e)}const Mr=new Set(["insertOrderedList","insertUnorderedList","deleteOrderedList","deleteUnorderedList"]);function Br(e,t,n,i){const r=Y(i);let o=r?Lr(e,t,n,i.parse):vr(e,t,n,i.parse);return i.resetFormatOnNewline&&!r&&/^[\n\r]+$/.test(n)&&(o=_(o,l.None,t,n.length)),o}function ut(e,t,n,i){return Y(i)?xn(e,t,n-t,i.parse):kn(e,t,n-t,i.parse)}function at(e,t,n,i,r){const o=typeof t=="string"?t:oe(t);return e=Y(r)?Cr(e,n,i-n,o,r.parse):Er(e,n,i-n,o,r.parse),Array.isArray(t)&&(e=Rr(e,t,n,r)),e}function Ar(e,t,n,i){return Y(i)?Nr(e,t,n,i.parse):Sr(e,t,n,i.parse)}function X(e,t,n,i,r){const o=i-n;if(Y(r)){const s=Fe(e,[n,o]),u=_(s,t,n,o);return w(_e(u,[n,o]),r.parse)}return _(e,t,n,o)}function wn(e,t,n,i,r){let o;if(n!==i)o=K(e,n,i)[0];else{const s=R(e,n,"start");s.index!==-1&&(o=e[s.index])}if(o){const s=o.format&t?{remove:t}:{add:t};return X(e,s,n,i,r)}return!e.length&&t?X(e,{add:t},0,0,r):e}function Rr(e,t,n=0,i){return t.forEach(r=>{var s;const o=r.value.length;if("sticky"in r&&r.sticky?e=X(e,r.format,n,n+o,i):r.format&&(e=X(e,{add:r.format},n,n+o,i)),U(r)&&(e=I(e,r.link,n,o)),(s=r.emoji)!=null&&s.length){const u=Re(r.emoji,n,r.value);e=bn(e,u)}n+=o}),e}const Tt={formatBold:l.Bold,formatItalic:l.Italic,formatUnderline:l.Underline,formatStrikeThrough:l.Strike};function vn(e,t){if(Mr.has(e.inputType))return e.preventDefault(),t}function En(e,t,n,i){const{inputType:r}=e;if(r&&F(r,"format")){const[o,s]=n;if(r==="formatFontColor"){const u=/^rgb\(0,\s*0,\s*0\)/.test(e.data)||e.data==="transparent"?{remove:l.Marked}:{add:l.Marked};return _(t,u,o,s-o)}return r==="formatRemove"?_(t,l.None,o,s-o):r in Tt?wn(t,Tt[r],o,s,i):t}}function Sn(e,t,n,i){const{inputType:r}=e;if(r&&F(r,"insert")){const o=Fr(e);return at(t,o,n[0],n[1],i)}}function Or(e,t,n,i,r){let[o,s]=i,u="";if(Le(i)){const a=A(t);a>e.length?(o=Math.min(o,n[0]),s=Math.max(s,n[1]),o===s&&(s+=a-e.length)):u=e.slice(o,Math.max(n[0],n[1]))}else u=e.slice(Math.min(o,n[0]),n[1]);return at(t,u,o,s,r)}function Pr(e,t,n,i,r){const o=vn(e,t)||En(e,t,n,r)||Sn(e,t,i,r);if(o)return o;const{inputType:s}=e;if(s&&F(s,"delete")){const[u,a]=n,[h,m]=i,p=Math.min(u,h);let g=Math.max(a,m);if(p===g&&e.inputType.includes("Forward")){const S=Ot(e.currentTarget).length,N=A(t);N>S&&(g+=N-S)}return ut(t,p,g,r)}return t}function Dr(e,t,n,i){const r=vn(e,t)||En(e,t,n,i)||Sn(e,t,n,i);if(r)return r;const{inputType:o}=e;return o&&o.startsWith("delete")?ut(t,n[0],n[1],i):t}function oe(e){return e.map(t=>t.value).join("")}function Y(e){var t;return!!((t=e.parse)!=null&&t.markdown)}function Fr(e){return e.inputType==="insertParagraph"||e.inputType==="insertLineBreak"?`
`:e.data!=null?e.data:e.dataTransfer?e.dataTransfer.getData("text/plain"):""}const B={ctrl:1,alt:2,shift:4,meta:8,any:256};class _r{constructor(t){this.ctx=t,this.shortcuts={}}register(t,n){return Array.isArray(t)||(t=[t]),t.forEach(i=>this.shortcuts[Lt(i)]=n),this}registerAll(t){Object.keys(t).forEach(n=>{this.register(n,t[n])})}unregister(t,n){return Array.isArray(t)||(t=[t]),t.forEach(i=>{const r=Lt(i);this.shortcuts[r]&&(!n||this.shortcuts[r]===n)&&delete this.shortcuts[r]}),this}unregisterAll(){return this.shortcuts={},this}handle(t){const n=$r(t.keyCode?zr(t.keyCode):t.key),i=Ir(t);let r=`${i}:${n}`;!this.shortcuts[r]&&i&&(r=`${B.any}:${n}`);const o=this.shortcuts[r];return o&&o(this.ctx,t)!==!1?(t.preventDefault(),!0):!1}}function Ir(e){let t=0;return e.altKey&&(t|=B.alt),e.shiftKey&&(t|=B.shift),e.ctrlKey&&(t|=B.ctrl),e.metaKey&&(t|=B.meta),t}function $r(e){return e.replace(/^(Key|Digit|Numpad)/,"").toLowerCase()}function Lt(e){let t=0,n="";return e.toLowerCase().split(/[+-]/g).forEach(i=>{i==="cmd"&&(i=navigator.platform==="MacIntel"?"meta":"ctrl"),i in B?t|=B[i]:n=i}),`${t}:${n}`}function zr(e){return e===27?"Escape":e===13?"Enter":String.fromCharCode(e)}function Ur(e){let t=me(e);const n=t.match(/^\s+/);n&&(t=t.slice(n[0].length),e=K(e,n[0].length));const i=t.match(/\s+$/);return i&&(t=t.slice(0,-i[0].length),e=K(e,0,-i[0].length)),{text:t,tokens:e}}const Ct=new Set(["p","div","h1","h2","h3","h4","blockquote","section","br","hr"]),qr=new Set(["base","head","link","meta","style","script","title","area","audio","map","track","video","embed","iframe","object","param","picture","portal","source","svg","math","noscript","datalist","select","template"]),Ee=new Set(["normal","unset","initial","revert","none"]),Hr=["jetbrains mono","fira code","pt mono","menlo","courier","monospace"],Se={b:l.Bold,strong:l.Bold,i:l.Italic,em:l.Italic,code:l.Monospace,pre:l.Monospace,var:l.Monospace,s:l.Strike,u:l.Underline};function Wr(e,t){const i=new DOMParser().parseFromString(e,"text/html"),r=new Kr(t);Tn(i.body||i.documentElement,r);const o=E(r.tokens);return Ur(o).tokens}function Tn(e,t){for(e=e.firstChild;e;){if(Vr(e))t.pushText(e.nodeValue);else if(Qr(e)){const n=Mt(e);if(!qr.has(n)){const{format:i,link:r}=t;if(t.format=Xr(e,t.format),n==="tr"?t.pushNewline(1):n==="td"?t.pushText(" "):(Ct.has(n)||e.previousSibling&&Ct.has(Mt(e.previousSibling)))&&t.pushNewline(),n==="input"){const o=e.getAttribute("value"),s=(e.getAttribute("type")||"").toLowerCase();o&&s!=="radio"&&s!=="checkbox"&&t.tokens.push(le(o,t.format))}else if(n==="img"){const o=e.getAttribute("alt");o&&t.tokens.push(le(o,t.format))}else{if(n==="a"&&t.options.links){const o=e.getAttribute("href");Jr(o)&&(t.link=o)}Tn(e,t)}t.format=i,t.link=r}}e=e.nextSibling}}function Qr(e){return e.nodeType===1}function Vr(e){return e.nodeType===3}class Kr{constructor(t){this.format=l.None,this.tokens=[],this.link=null,this.options=y({links:!1},t)}pushText(t){let n=Cn(t)?this.handleWhitespace(t):this.handleText(t);n&&(this.link&&(n=I(E(n),this.link,0,A(n))),this.tokens=this.tokens.concat(n))}pushNewline(t){Nt(this.tokens,t)&&this.tokens.push(Ln())}handleWhitespace(t){var i;let n="";return this.format&l.Monospace?((i=k(this.tokens))==null?void 0:i.type)===c.Newline?n=t:Ue(this.tokens)&&(n=" "):Ue(this.tokens)&&Nt(this.tokens,1)&&(n=" "),n?[le(n,this.format)]:void 0}handleText(t){this.format&l.Monospace||(t=t.replace(/[\s\r\n]+/g," "));const n=new zt(t,y(Dt,{useFormat:!0}));if(n.format=this.format,this.link)for(;n.hasNext();)jt(n)||Ce(n)||Ne(n)||n.consumeText();else for(;n.hasNext();)jt(n)||Ce(n)||Ne(n)||Wt(n)||Qt(n)||Vt(n)||Kt(n)||Jt(n)||n.consumeText();return n.flushText(),n.tokens}}function Nt(e,t=2){for(let n=e.length-1;n>=0;n--){const i=e[n];if(i.type===c.Newline){if(t--,t<=0)return!1}else if(!Cn(i.value))return!0}return!0}function Ue(e){const t=k(e);if(t){const{value:n}=t;return!fe(n.charCodeAt(n.length-1))}return!0}function Xr(e,t=l.None){const n=e.nodeName.toLowerCase(),i=e.getAttribute("style");let r=t;if(n in Se&&(r|=Se[n]),i){const o=Gr(i),s=o["font-style"],u=o["font-weight"],a=(o["font-family"]||"").toLowerCase(),h=o["text-decoration-line"]||o["text-decoration"]||"";s==="italic"?r|=l.Italic:Ee.has(s)&&(r&=~l.Italic),u==="bold"||u==="bolder"?r|=l.Bold:Ee.has(u)?r&=~l.Bold:/^\d+$/.test(u)&&(parseInt(u,10)>400?r|=l.Bold:r&=~l.Bold),h.includes("underline")&&(r|=l.Underline),h.includes("line-through")&&(r|=l.Strike),Ee.has(h)&&(r&=~(l.Underline|l.Strike)),Zr(o.color)&&(r|=l.Marked),a&&(Hr.some(m=>a.includes(m))?r|=l.Monospace:Se[n]!==l.Monospace&&(r&=~l.Monospace))}return r}function Gr(e){const t={};return e.replace(/\/\*.?\*\//g,"").split(";").forEach(n=>{const[i,r]=n.split(":",2);r&&(t[i.trim().toLowerCase()]=r.trim().toLowerCase())}),t}function Jr(e){return e?/^mailto:/i.test(e)||/^https?:/i.test(e):!1}function jt(e){return an(e)?(e.format&l.Monospace?e.push(Ln(e.format)):Ue(e.tokens)&&e.push(le(" ",e.format)),!0):!1}function le(e,t){return{type:c.Text,value:e,format:t,sticky:!1}}function Ln(e=l.None){return{type:c.Newline,format:e,value:`
`}}function Cn(e){return/^[\s\r\n]+$/.test(e)}function Mt(e){return e.nodeName.toLowerCase()}function Zr(e){return e?/#f00|#ff0000|rgb\(\s*255\s*,\s*0\s*,\s*0\s*\)/.test(e):!1}const Yr=[[l.Bold,"font-weight:bold"],[l.Italic,"font-style:italic"],[l.Monospace,"font-family:monospace"],[l.Strike,"text-decoration:line-through"],[l.Underline,"text-decoration:underline"],[l.Heading,"font-size:2em"],[l.Marked,"color:#FB372B"]];function eo(e){const t=[];for(let n=0;n<e.length;n++)n=to(e,n,t);return t.join("")}function to(e,t,n){const i=e[t];if(!i.value)return t;const r=gn(e,t);if(r!==t){const o=i.format,s=no(i,n);for(;t<=r;){const u=e[t];u.format===o?n.push(i.value):Bt(u,n),t++}return n.push(`</${s}>`),r}return i.type===c.Newline||yn(i)?n.push(i.value):Bt(i,n),t}function no(e,t){let n=Nn(e),i="span";return it(e)&&(i="a",n+=` href="${e.link}"`),t.push(`<${i}${n}>`),i}function Bt(e,t){e.type!==c.UserSticker&&t.push(`<span${Nn(e)}>${e.value}</span>`)}function Nn(e){const t=io(e.format);return t?` style="${t}"`:""}function io(e){const t=[];return Yr.forEach(([n,i])=>{e&n&&t.push(i)}),t.join(";")}const jn="tamtam/fragment",ro={url:e=>prompt("Введите ссылку",e)};class Mn{constructor(t,n={}){this.element=t,this.options=n,this.compositionStartRange=null,this.compositionRange=null,this.pendingModel=null,this._inited=!1,this.dirty=0,this.caret=[0,0],this.focused=!1,this.rafId=0,this.onKeyDown=r=>{r.defaultPrevented||this.shortcuts.handle(r),this.handleEnter(r)},this.onCompositionStart=()=>{this.compositionStartRange=x(this.element),this.compositionRange=null},this.onCompositionUpdate=()=>{this.compositionRange=this.getCompositionRange()},this.onCompositionEnd=()=>{this.compositionStartRange=null},this.onBeforeInput=r=>{if(r.inputType==="historyUndo"){this.undo(),r.preventDefault();return}if(r.inputType==="historyRedo"){this.redo(),r.preventDefault();return}let o;if(r.getTargetRanges){const s=r.getTargetRanges();s.length&&(o=et(this.element,s[0]))}o||(o=x(this.element)),this.pendingModel=Dr(r,this.model,o,this.options)},this.onInput=r=>{let o;const s=x(this.element);if(this.pendingModel)o=this.pendingModel,this.compositionStartRange||(this.pendingModel=null);else{const u=this.compositionRange||this.caret;o=r.inputType?Pr(r,this.model,s,u,this.options):Or(this.getInputText(),this.model,s,u,this.options),this.compositionRange=null}o&&this.updateModel(o,uo(r),s)},this.onSelectionChange=()=>{if(this.dirty!==0)return;const r=x(this.element);r&&this.saveSelection(r)},this.onCopy=r=>{this.copyFragment(r.clipboardData)&&r.preventDefault()},this.onCut=r=>{this.copyFragment(r.clipboardData,!0)&&r.preventDefault()},this.onPaste=r=>{var a;if(r.preventDefault(),ao(r.clipboardData))return;const o=x(this.element),u=so(r.clipboardData,this.options)||Q(r.clipboardData.getData("text/plain")||"");if(u&&o){let h=0;typeof u=="string"?h=u.length:(h=A(u),(a=k(u))!=null&&a.format&&u.push({type:c.Text,value:"",format:Tr(this.model,o[0]),sticky:!0})),this.paste(u,o[0],o[1]),this.setSelection(o[0]+h),requestAnimationFrame(()=>Rt(this.getScroller()))}},this.onClick=r=>{if(ae(r.target)){const o=r.target,s=o.getBoundingClientRect(),u=s.left+s.width*.6,a=document.createRange();r.clientX<u?(a.setStartBefore(o),a.setEndBefore(o)):(a.setStartAfter(o),a.setEndAfter(o)),hn(a)}},this.onFocus=()=>{this.focused=!0,document.addEventListener("selectionchange",this.onSelectionChange)},this.onBlur=()=>{this.focused=!1,document.removeEventListener("selectionchange",this.onSelectionChange)};const i=n.value||"";this.model=w(this.sanitizeText(i),n.parse),this.history=new pr({compactActions:["insert","remove"]}),this.shortcuts=new _r(this),this.setup(),this.history.push(this.model,"init",this.caret),this._inited=!0}get model(){return this._model}set model(t){this._model!==t&&(this._model=t,this.dirty===0&&(this.dirty=1),this.scheduleSyncUI())}get isMarkdown(){var t;return!!((t=this.options.parse)!=null&&t.markdown)}setup(){const{element:t}=this;t.contentEditable="true",t.translate=!1,t.addEventListener("keydown",this.onKeyDown),t.addEventListener("compositionstart",this.onCompositionStart),t.addEventListener("compositionupdate",this.onCompositionUpdate),t.addEventListener("compositionend",this.onCompositionEnd),t.addEventListener("beforeinput",this.onBeforeInput),t.addEventListener("input",this.onInput),t.addEventListener("cut",this.onCut),t.addEventListener("copy",this.onCopy),t.addEventListener("paste",this.onPaste),t.addEventListener("click",this.onClick),t.addEventListener("focus",this.onFocus),t.addEventListener("blur",this.onBlur);const{shortcuts:n}=this.options;n&&this.shortcuts.registerAll(n)}dispose(){const{element:t}=this;t.removeEventListener("keydown",this.onKeyDown),t.removeEventListener("compositionstart",this.onCompositionStart),t.removeEventListener("compositionupdate",this.onCompositionUpdate),t.removeEventListener("compositionend",this.onCompositionEnd),t.removeEventListener("beforeinput",this.onBeforeInput),t.removeEventListener("input",this.onInput),t.removeEventListener("cut",this.onCut),t.removeEventListener("copy",this.onCopy),t.removeEventListener("paste",this.onPaste),t.removeEventListener("click",this.onClick),t.removeEventListener("focus",this.onFocus),t.removeEventListener("blur",this.onBlur),document.removeEventListener("selectionchange",this.onSelectionChange)}insertText(t,n){return n=this.sanitizeText(n),this.updateModel(Br(this.model,t,n,this.options),"insert",[t,t+n.length])}removeText(t,n){return this.updateModel(ut(this.model,t,n,this.options),"remove",[t,n])}replaceText(t,n,i){return this.paste(i,t,n)}cut(t,n){const i=Ar(this.model,t,n,this.options);return this.updateModel(i.tokens,"cut",[t,n]),i.cut}paste(t,n,i){t=this.sanitizeText(t);const r=at(this.model,t,n,i,this.options),o=typeof t=="string"?t.length:A(t),s=n+o;return this.updateModel(r,"paste",[s,s])}focus(){const[t,n]=this.caret;this.element.focus(),H(this.element,t,n)}updateFormat(t,n,i=n){const r=this.updateModel(X(this.model,t,n,i,this.options),"format",[n,i]);return H(this.element,n,i),this.emit("editor-formatchange"),r}toggleFormat(t,n,i){if(n==null){const s=this.getSelection();n=s[0],i=s[1]}else i==null&&(i=n);const r=wn(this.model,t,n,i,this.options),o=this.updateModel(r,"format",[n,i]);return H(this.element,n,i),this.emit("editor-formatchange"),o}pickLink(t=ro){const[n,i]=t.range||this.getSelection();let r=this.tokenForPos(n),o="";if(r){if(r.format&l.LinkLabel){let u=this.model.indexOf(r)+1;for(;u<this.model.length&&(r=this.model[u++],r.type!==c.Link););}r.type===c.Link&&(o=r.link)}const s=t.url(o);s&&typeof s=="object"&&s.then?s.then(u=>{u!==o&&this.setLink(u,n,i)}):s!==o&&this.setLink(s,n,i)}setLink(t,n,i=n){t&&(t=t.trim());let r;const o=[n,i-n];if(this.isMarkdown){const s=Fe(this.model,o),u=I(s,t,o[0],o[1]);r=w(_e(u,o),this.options.parse)}else r=I(this.model,t,o[0],o[1]);return this.updateModel(r,"link")}undo(){if(this.history.canUndo){const t=this.history.undo();this.updateModel(t.state,!1);const{current:n}=this.history;if(n){const i=n.caret||n.range;i&&this.setSelection(i[0],i[1])}return t}}redo(){if(this.history.canRedo){const t=this.history.redo();this.updateModel(t.state,!1);const n=t.caret||t.range;return n&&this.setSelection(n[0],n[1]),t}}slice(t,n){return K(this.model,t,n)}tokenForPos(t,n){let i=0,r=0;const{model:o}=this;for(let s=0,u;s<o.length;s++){if(u=o[s],r=i+u.value.length,t>=i&&(n?t<=r:t<r))return u;i+=u.value.length}if(i===t)return o[o.length-1]}getSelection(){return this.caret}setSelection(t,n=t){[t,n]=this.normalizeRange([t,n]),this.saveSelection([t,n]),this.dirty||H(this.element,t,n)}setValue(t,n){if(typeof t=="string"&&(t=w(this.sanitizeText(t),this.options.parse)),!n){const i=oe(t).length;n=[i,i]}this.saveSelection(n),this.model=t,this.history.clear(),this.history.push(this.model,"init",this.caret)}replaceValue(t,n){this._inited=!1,this.setValue(t,n),this._inited=!0}getText(t=this.model){return oe(t)}setOptions(t){var i,r;let n=!1;if(t.shortcuts&&(this.shortcuts.unregisterAll(),this.shortcuts.registerAll(t.shortcuts)),t.parse){const o=!!((i=this.options.parse)!=null&&i.markdown);n=t.parse.markdown!==o}if(this.options=y(this.options,t),n){const o=this.getSelection(),s=[o[0],o[1]-o[0]],u=(r=this.options.parse)!=null&&r.markdown?_e(this.model,s):Fe(this.model,s);this.setValue(u,[s[0],s[0]+s[1]])}else this.render()}getInputText(){return Ot(this.element)}on(t,n,i){return this.element.addEventListener(t,n,i),this}off(t,n,i){return this.element.removeEventListener(t,n,i),this}saveSelection(t){const{caret:n}=this;this.caret=t,this.history.saveCaret(t),(n[0]!==t[0]||n[1]!==t[1])&&this.emit("editor-selectionchange")}updateModel(t,n,i){return t!==this.model&&(typeof n=="string"&&this.history.push(t,n,i),this.model=t),i&&this.saveSelection(i),this.model}copyFragment(t,n){const i=x(this.element);if(i&&!Le(i)){const r=n?this.cut(i[0],i[1]):this.slice(i[0],i[1]);return t.setData("text/plain",oe(r)),t.setData("text/html",eo(r)),this.isMarkdown||t.setData(jn,JSON.stringify(r)),n&&this.setSelection(i[0]),!0}return!1}syncUI(){if(this.render(),this.focused){const[t,n]=this.caret;H(this.element,t,n)}this.dirty===2&&Rt(this.getScroller()),this.dirty=0,this.emit("editor-update")}scheduleSyncUI(){this.rafId||(this.rafId=requestAnimationFrame(()=>{this.rafId=0,this.dirty!==0&&this.syncUI()}))}render(){var t;nr(this.element,this.model,{fixTrailingLine:!0,replaceTextEmoji:!!((t=this.options.parse)!=null&&t.textEmoji),emoji:this.options.emoji,nowrap:this.options.nowrap})}emit(t){this._inited&&rt(this.element,t,{editor:this})}normalizeRange([t,n]){const i=A(this.model);return[At(t,0,i),At(n,0,i)]}handleEnter(t){if(!t.defaultPrevented&&t.key==="Enter"&&lo(t)){t.preventDefault();const n=x(this.element),i=`
`;Le(n)?this.insertText(n[0],i):this.replaceText(n[0],n[1],i),this.setSelection(n[0]+i.length),this.dirty=2}}sanitizeText(t){const{nowrap:n}=this.options;return typeof t=="string"?Q(t,n):t.map(i=>y(i,{value:Q(i.value,n)}))}getCompositionRange(){const t=x(this.element);return this.compositionStartRange&&(t[0]=Math.min(this.compositionStartRange[0],t[0])),t}getScroller(){return this.options.scroller||this.element}}function At(e,t,n){return Math.min(Math.max(e,t),n)}function Rt(e){const n=window.getSelection().getRangeAt(0);if(!(n!=null&&n.collapsed))return;let i=n.getClientRects().item(0);if((!i||!i.height)&&$(n.startContainer)){const r=oo(n);r&&(i=r.getBoundingClientRect())}if(i&&i.height>0){const r=e.getBoundingClientRect();(i.top<r.top||i.bottom>r.bottom)&&(e.scrollTop+=i.top-(r.top+r.height/2))}}function oo(e){const t=e.startContainer.childNodes[e.startOffset];return t&&$(t)?t:e.startContainer}function so(e,t){const n=e.getData(jn);if(n)return typeof n=="string"?JSON.parse(n):n;if(t.html){const i=w(Q(e.getData("text/plain")||""),t.parse);if(i.length===1&&i[0].type===c.Link)return i;const r=e.getData("text/html");if(r)return Wr(Q(r),{links:t.htmlLinks})}}function uo(e){const{inputType:t}=e;if(t){if(F(t,"insert"))return"insert";if(F(t,"delete"))return"remove";if(F(t,"format"))return"format"}return"update"}function Q(e,t){return e=e.replace(/\x00/g," "),t?e.replace(/(\r\n?|\n)/g," "):e.replace(/\r\n?/g,`
`)}function ao(e){if(e.types.includes("Files")){let t=0,n=0;for(let i=0;i<e.items.length;i++){const r=e.items[i];r.kind==="string"?n++:r.kind==="file"&&t++}return t>=n}return!1}function lo(e){return e.altKey||e.ctrlKey||e.shiftKey||e.metaKey}const Bn={"Cmd+Z":e=>e.undo(),"Cmd+Y":e=>e.redo(),"Cmd+Shift+Z":e=>e.redo(),"Cmd+B":e=>e.toggleFormat(l.Bold),"Cmd+I":e=>e.toggleFormat(l.Italic),"Cmd+U":e=>e.toggleFormat(l.Strike),"Cmd+Shift+C":e=>e.toggleFormat(l.Monospace),"Ctrl+L":e=>e.pickLink()};let qe;const v=document.querySelector(".toolbar"),lt=new Mn(document.querySelector("#text-editor"),{value:"Привет, мир! 😇",shortcuts:Bn,parse:{textEmoji:!0,hashtag:!0,mention:!0,command:!0,userSticker:!0,link:!0,stickyLink:!0},emoji:Rn,resetFormatOnNewline:!0,html:!0,scroller:document.querySelector("#text-editor-scroller")});lt.on("editor-selectionchange",e=>On(e.detail.editor)).on("editor-formatchange",e=>ct(e.detail.editor));mo(lt);const An=new Mn(document.querySelector("#md-editor"),{value:"Привет, *markdown* мир! 😇",shortcuts:Bn,parse:{textEmoji:!0,hashtag:!0,mention:!0,command:!0,userSticker:!0,link:!0,markdown:!0},emoji:Rn});An.on("editor-selectionchange",e=>On(e.detail.editor)).on("editor-formatchange",e=>ct(e.detail.editor));v.addEventListener("mousedown",e=>{const t=e.target.closest(".toolbar-btn");if(t){e.preventDefault();const n=t.dataset.format;n?qe.toggleFormat(Number(n)):t.classList.contains("link")&&qe.pickLink()}});function Rn(e,t){if(e==null)return;const n=[];let i=0,r=0;for(;i<e.length;)r=e.codePointAt(i),i+=r>65535?2:1,r!==65039&&r!==8205&&n.push(r.toString(16));const o=`//st.mycdn.me/static/emoji/14-0-0/20/${n.join("-")}@2x.png`;return t||(t=document.createElement("img")),t.getAttribute("src")!==o&&t.setAttribute("src",o),t}function On(e){qe=e;const t=e.getSelection();t[0]!==t[1]?(ho(e),co(e)):fo()}function co(e){const t=window.getSelection();if(t){const n=t.getRangeAt(0);if(n){const i=n.getClientRects().item(0),r=e.element.getBoundingClientRect();i&&r&&(v.style.left=`${i.left-r.left-5}px`,v.style.top=`${i.top-r.top-v.offsetHeight-5}px`,ct(e))}}}function ct(e){if(v.classList.contains("hidden"))return;const t=e.tokenForPos(e.getSelection()[0]);for(const n of v.querySelectorAll(".toolbar-btn")){const i=Number(n.dataset.format||"0");i&&n.classList.toggle("selected",!!(t.format&i)),n.classList.contains("link")&&n.classList.toggle("selected",!!(t.type==="link"&&!t.auto||t.format&128))}}function fo(){v.classList.add("hidden")}function ho(e){v.classList.remove("hidden");const t=e.options.scroller||e.element;v.parentElement!==t.parentElement&&t.parentElement.appendChild(v)}const b=document.getElementById("raw-editor");b&&(b.addEventListener("beforeinput",e=>{const{rangeOffset:t,rangeParent:n}=e;if(console.log("raw before",e.inputType,x(b),{rangeOffset:t,rangeParent:n},e),e.getTargetRanges)if(e.getTargetRanges().length){const r=et(b,e.getTargetRanges()[0]);console.log("before: start range",r)}else console.log("before: no target ranges")}),b.addEventListener("input",e=>{const{rangeOffset:t,rangeParent:n}=e;console.log("raw input",e.inputType,x(b),{rangeOffset:t,rangeParent:n},e)}),b.addEventListener("compositionstart",Te),b.addEventListener("compositionend",Te),b.addEventListener("compositionupdate",Te));function Te(e){console.log(e.type,JSON.stringify(e.data),x(b),e)}function mo(e){let t=new Map;const n=e.element.parentElement.querySelector(".editor-overlay"),i=()=>{const o=new Map,s=e.element.getBoundingClientRect();for(const u of e.element.querySelectorAll("img")){let a=t.get(u);a?t.delete(u):(a=document.createElement("div"),a.className="rect",n.appendChild(a)),o.set(u,a);const h=u.getBoundingClientRect();a.style.left=`${h.left-s.left}px`,a.style.top=`${h.top-s.top}px`}for(const u of t.values())u.remove();t=o};new ResizeObserver(()=>i()).observe(e.element),e.on("editor-update",i),e.on("editor-formatchange",i),i()}window.editor=lt;window.mdEditor=An;
